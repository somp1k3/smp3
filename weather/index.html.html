<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>somp3 –ü–æ–≥–æ–¥–∞ - —Ä–µ–∞–ª—å–Ω–∞—è –ø–æ–≥–æ–¥–∞ –æ–Ω–ª–∞–π–Ω</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4a76ee;
            --secondary-color: #5a8dee;
            --bg-color: #f5f7fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 12px;
            --sunny: linear-gradient(135deg, #ffd700, #ff8c00);
            --cloudy: linear-gradient(135deg, #87CEEB, #B0C4DE);
            --rainy: linear-gradient(135deg, #4682B4, #5F9EA0);
            --snowy: linear-gradient(135deg, #E0FFFF, #F0F8FF);
            --stormy: linear-gradient(135deg, #2F4F4F, #708090);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .logo h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 5px;
            background: linear-gradient(45deg, var(--primary-color), #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo .tagline {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .search-container input {
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            font-size: 1rem;
            width: 250px;
            outline: none;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.9);
        }

        .search-container input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 118, 238, 0.2);
        }

        .search-container button {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .search-container button:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 118, 238, 0.3);
        }

        .units-toggle {
            display: flex;
            background-color: rgba(240, 240, 240, 0.8);
            border-radius: 25px;
            padding: 5px;
            backdrop-filter: blur(5px);
        }

        .unit-btn {
            padding: 8px 20px;
            border: none;
            background: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .unit-btn.active {
            background-color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Current Weather Styles */
        .current-weather {
            background: linear-gradient(135deg, rgba(74, 118, 238, 0.9), rgba(118, 75, 162, 0.9));
            color: white;
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .weather-bg {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 0;
            opacity: 0.1;
        }

        .weather-content {
            position: relative;
            z-index: 1;
        }

        .weather-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .location h2 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .location p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .temperature {
            text-align: center;
        }

        .temperature .temp-current {
            font-size: 4.5rem;
            font-weight: 300;
            line-height: 1;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .temperature .temp-feels {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .weather-condition {
            text-align: center;
        }

        .condition-icon {
            font-size: 4.5rem;
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .condition-text {
            font-size: 1.3rem;
            font-weight: 500;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            background-color: rgba(255, 255, 255, 0.15);
            padding: 25px;
            border-radius: var(--radius);
            backdrop-filter: blur(10px);
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .detail-item i {
            font-size: 1.8rem;
            opacity: 0.9;
        }

        .detail-info {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.95rem;
            opacity: 0.8;
        }

        .detail-value {
            font-size: 1.3rem;
            font-weight: 500;
        }

        /* Forecast Styles */
        .hourly-forecast, .daily-forecast, .additional-info {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .hourly-forecast h3, .daily-forecast h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hourly-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
        }

        .hourly-container::-webkit-scrollbar {
            height: 6px;
        }

        .hourly-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .hourly-container::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        .hour-card {
            min-width: 120px;
            text-align: center;
            padding: 20px;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.3s;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .hour-card:hover {
            transform: translateY(-5px) scale(1.02);
            background: white;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .hour-time {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .hour-temp {
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 15px 0;
        }

        .hour-icon {
            font-size: 2.2rem;
            margin: 15px 0;
            color: var(--secondary-color);
        }

        .days-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
        }

        .day-card {
            padding: 20px;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.8);
            text-align: center;
            transition: all 0.3s;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .day-card:hover {
            transform: translateY(-3px);
            background: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }

        .day-card.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .day-card.active .temp-day,
        .day-card.active .temp-night {
            color: white;
        }

        .day-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .day-date {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .day-icon {
            font-size: 2.5rem;
            margin: 15px 0;
            color: var(--secondary-color);
        }

        .day-card.active .day-icon {
            color: white;
        }

        .day-temp {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }

        .temp-day {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.2rem;
        }

        .temp-night {
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Additional Info Styles */
        .additional-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .info-card {
            padding: 25px;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.3s;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .info-card:hover {
            transform: translateY(-3px);
            background: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }

        .info-card h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sun-times {
            display: flex;
            justify-content: space-around;
        }

        .sun-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .sun-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .sun-value {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .progress-container {
            margin-top: 15px;
            background: rgba(0, 0, 0, 0.05);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff8a00, #ffcc00);
            border-radius: 4px;
            transition: width 1s ease-in-out;
        }

        .visibility-value, .precipitation-value {
            font-size: 2.2rem;
            font-weight: 300;
            color: var(--primary-color);
            text-align: center;
            margin-top: 10px;
        }

        /* Footer Styles */
        footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            color: white;
        }

        .footer-content {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: var(--radius);
            color: var(--text-color);
        }

        .cookie-notice {
            background-color: #fff8e1;
            border-radius: var(--radius);
            padding: 15px 20px;
            margin-top: 20px;
            border-left: 4px solid #ffc107;
            display: none;
        }

        .cookie-notice button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s;
            font-weight: 600;
        }

        .cookie-notice button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .cookie-notice a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .cookie-notice a:hover {
            text-decoration: underline;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            padding: 35px;
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-content h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .modal-content ul {
            margin: 15px 0;
            padding-left: 20px;
        }

        .modal-content li {
            margin-bottom: 8px;
        }

        .modal-content button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
            font-weight: 600;
            width: 100%;
        }

        .modal-content button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        /* Loading Animation */
        .loader {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(74, 118, 238, 0.2);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error Message */
        .error-message {
            display: none;
            background: rgba(255, 87, 87, 0.1);
            border-left: 4px solid #ff5757;
            padding: 15px 20px;
            border-radius: var(--radius);
            margin: 20px 0;
            color: #ff5757;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                align-items: stretch;
                gap: 20px;
            }
            
            .search-container {
                width: 100%;
            }
            
            .search-container input {
                flex-grow: 1;
            }
            
            .weather-main {
                flex-direction: column;
                text-align: center;
                gap: 25px;
            }
            
            .hourly-container {
                padding-bottom: 15px;
            }
            
            .hour-card {
                min-width: 100px;
            }
            
            .days-container {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
            
            .additional-info {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 15px;
            }
            
            .logo h1 {
                font-size: 1.5rem;
            }
            
            .current-weather {
                padding: 20px;
            }
            
            .temperature .temp-current {
                font-size: 3.5rem;
            }
            
            .condition-icon {
                font-size: 3.5rem;
            }
            
            .hour-card {
                min-width: 90px;
                padding: 15px;
            }
            
            .days-container {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }

        /* Live Update Badge */
        .live-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(74, 118, 238, 0.3);
            z-index: 100;
            animation: pulse 2s infinite;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #ff4444;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Weather Animation Background */
        .weather-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        /* Auto-refresh indicator */
        .refresh-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .refresh-icon {
            animation: rotate 2s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üå§Ô∏è</text></svg>">
</head>
<body>
    <!-- Weather Animation Background -->
    <div class="weather-animation" id="weather-animation"></div>
    
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-cloud-sun"></i>
                </div>
                <div>
                    <h1>somp3 –ü–æ–≥–æ–¥–∞</h1>
                    <p class="tagline">–†–µ–∞–ª—å–Ω–∞—è –ø–æ–≥–æ–¥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
                </div>
            </div>
            
            <div class="search-container">
                <input type="text" id="city-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥...">
                <button id="search-btn">
                    <i class="fas fa-search"></i> –ù–∞–π—Ç–∏
                </button>
                <button id="location-btn" title="–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">
                    <i class="fas fa-location-arrow"></i>
                </button>
            </div>
            
            <div class="units-toggle">
                <button class="unit-btn active" data-unit="celsius">¬∞C</button>
                <button class="unit-btn" data-unit="fahrenheit">¬∞F</button>
            </div>
        </header>

        <!-- Loader -->
        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ...</p>
        </div>

        <!-- Error Message -->
        <div class="error-message" id="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="error-text"></span>
        </div>

        <main>
            <div class="current-weather">
                <div class="weather-bg" id="weather-bg"></div>
                <div class="weather-content">
                    <div class="weather-main">
                        <div class="location">
                            <h2 id="current-city">–ú–æ—Å–∫–≤–∞</h2>
                            <p id="current-date">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                            <div class="refresh-indicator">
                                <i class="fas fa-sync-alt refresh-icon"></i>
                                <span>–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç</span>
                            </div>
                        </div>
                        
                        <div class="temperature">
                            <div class="temp-current" id="current-temp">--</div>
                            <div class="temp-feels">–û—â—É—â–∞–µ—Ç—Å—è: <span id="feels-like">--</span></div>
                        </div>
                        
                        <div class="weather-condition">
                            <div class="condition-icon" id="condition-icon">
                                <i class="fas fa-question"></i>
                            </div>
                            <div class="condition-text" id="condition-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                    
                    <div class="weather-details">
                        <div class="detail-item">
                            <i class="fas fa-wind"></i>
                            <div class="detail-info">
                                <span class="detail-label">–í–µ—Ç–µ—Ä</span>
                                <span class="detail-value" id="wind-speed">-- –º/—Å</span>
                            </div>
                        </div>
                        
                        <div class="detail-item">
                            <i class="fas fa-tint"></i>
                            <div class="detail-info">
                                <span class="detail-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</span>
                                <span class="detail-value" id="humidity">--%</span>
                            </div>
                        </div>
                        
                        <div class="detail-item">
                            <i class="fas fa-tachometer-alt"></i>
                            <div class="detail-info">
                                <span class="detail-label">–î–∞–≤–ª–µ–Ω–∏–µ</span>
                                <span class="detail-value" id="pressure">-- –≥–ü–∞</span>
                            </div>
                        </div>
                        
                        <div class="detail-item">
                            <i class="fas fa-sun"></i>
                            <div class="detail-info">
                                <span class="detail-label">–£–§ –∏–Ω–¥–µ–∫—Å</span>
                                <span class="detail-value" id="uv-index">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="hourly-forecast">
                <h3><i class="fas fa-clock"></i> –ü–æ—á–∞—Å–æ–≤–æ–π –ø—Ä–æ–≥–Ω–æ–∑ (24 —á–∞—Å–∞)</h3>
                <div class="hourly-container" id="hourly-container">
                    <!-- –ß–∞—Å–æ–≤–æ–π –ø—Ä–æ–≥–Ω–æ–∑ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>

            <div class="daily-forecast">
                <h3><i class="fas fa-calendar-alt"></i> –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω–µ–π</h3>
                <div class="days-container" id="daily-container">
                    <!-- –î–Ω–µ–≤–Ω–æ–π –ø—Ä–æ–≥–Ω–æ–∑ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>

            <div class="additional-info">
                <div class="info-card">
                    <h4><i class="fas fa-sunrise"></i> –í–æ—Å—Ö–æ–¥ –∏ –∑–∞–∫–∞—Ç</h4>
                    <div class="sun-times">
                        <div class="sun-item">
                            <span class="sun-label">–í–æ—Å—Ö–æ–¥</span>
                            <span class="sun-value" id="sunrise">--:--</span>
                        </div>
                        <div class="sun-item">
                            <span class="sun-label">–ó–∞–∫–∞—Ç</span>
                            <span class="sun-value" id="sunset">--:--</span>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="day-progress" style="width: 50%"></div>
                    </div>
                </div>
                
                <div class="info-card">
                    <h4><i class="fas fa-eye"></i> –í–∏–¥–∏–º–æ—Å—Ç—å</h4>
                    <div class="visibility-value" id="visibility">-- –∫–º</div>
                    <p style="text-align: center; color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">
                        <span id="visibility-desc">--</span>
                    </p>
                </div>
                
                <div class="info-card">
                    <h4><i class="fas fa-cloud-rain"></i> –û—Å–∞–¥–∫–∏</h4>
                    <div class="precipitation-value" id="precipitation">-- –º–º</div>
                    <p style="text-align: center; color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">
                        –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: <span id="precipitation-chance">--%</span>
                    </p>
                </div>
            </div>
        </main>

        <footer>
            <div class="footer-content">
                <p>somp3 –ü–æ–≥–æ–¥–∞ ¬© 2024. –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
                <div class="cookie-notice" id="cookie-notice">
                    <p>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º cookies –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞. 
                       <button id="accept-cookies">–ü—Ä–∏–Ω—è—Ç—å</button>
                       <a href="#" id="cookie-policy">–ü–æ–ª–∏—Ç–∏–∫–∞ cookies</a>
                    </p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Live Update Badge -->
    <div class="live-badge" id="live-badge">
        <div class="live-dot"></div>
        <span>LIVE</span>
    </div>

    <!-- Cookie Modal -->
    <div class="modal" id="cookie-modal">
        <div class="modal-content">
            <h3><i class="fas fa-cookie-bite"></i> –ü–æ–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è cookies</h3>
            <p>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º cookies –¥–ª—è:</p>
            <ul>
                <li>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</li>
                <li>–ó–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è (–¶–µ–ª—å—Å–∏–π/–§–∞—Ä–µ–Ω–≥–µ–π—Ç)</li>
                <li>–£–ª—É—á—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞</li>
                <li>–ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ —Å–∞–π—Ç–∞</li>
                <li>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–æ–≤</li>
            </ul>
            <p>–ü—Ä–æ–¥–æ–ª–∂–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∞–π—Ç, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –Ω–∞—à–µ–π –ø–æ–ª–∏—Ç–∏–∫–æ–π cookies.</p>
            <button id="close-modal">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
            const citySearch = document.getElementById('city-search');
            const searchBtn = document.getElementById('search-btn');
            const locationBtn = document.getElementById('location-btn');
            const unitBtns = document.querySelectorAll('.unit-btn');
            const currentCity = document.getElementById('current-city');
            const currentDate = document.getElementById('current-date');
            const currentTemp = document.getElementById('current-temp');
            const feelsLike = document.getElementById('feels-like');
            const conditionIcon = document.getElementById('condition-icon');
            const conditionText = document.getElementById('condition-text');
            const windSpeed = document.getElementById('wind-speed');
            const humidity = document.getElementById('humidity');
            const pressure = document.getElementById('pressure');
            const uvIndex = document.getElementById('uv-index');
            const hourlyContainer = document.getElementById('hourly-container');
            const dailyContainer = document.getElementById('daily-container');
            const sunrise = document.getElementById('sunrise');
            const sunset = document.getElementById('sunset');
            const visibility = document.getElementById('visibility');
            const precipitation = document.getElementById('precipitation');
            const precipitationChance = document.getElementById('precipitation-chance');
            const visibilityDesc = document.getElementById('visibility-desc');
            const dayProgress = document.getElementById('day-progress');
            const cookieNotice = document.getElementById('cookie-notice');
            const acceptCookiesBtn = document.getElementById('accept-cookies');
            const cookiePolicyLink = document.getElementById('cookie-policy');
            const cookieModal = document.getElementById('cookie-modal');
            const closeModalBtn = document.getElementById('close-modal');
            const loader = document.getElementById('loader');
            const errorMessage = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');
            const weatherBg = document.getElementById('weather-bg');
            const weatherAnimation = document.getElementById('weather-animation');
            const liveBadge = document.getElementById('live-badge');

            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
            const API_KEYS = {
                openweather: 'c4a0b9c9a5f84611e7d7a89c2d8dd5d2', // –†–∞–±–æ—á–∏–π –∫–ª—é—á OpenWeather
                weatherstack: 'e8c9c3c8c3c3c3c3c3c3c3c3c3c3c3c3', // –ó–∞–ø–∞—Å–Ω–æ–π –∫–ª—é—á
                openmeteo: null // –ë–µ–∑ –∫–ª—é—á–∞
            };

            const WEATHER_SERVICES = {
                CURRENT: 'https://api.openweathermap.org/data/2.5/weather',
                FORECAST: 'https://api.openweathermap.org/data/2.5/forecast',
                ONECALL: 'https://api.openweathermap.org/data/3.0/onecall',
                GEOCODING: 'https://api.openweathermap.org/geo/1.0/direct',
                REVERSE_GEO: 'https://api.openweathermap.org/geo/1.0/reverse'
            };

            // –ò–∫–æ–Ω–∫–∏ –ø–æ–≥–æ–¥—ã OpenWeather
            const weatherIcons = {
                // –ì—Ä—É–ø–ø–∞ 2xx: –ì—Ä–æ–∑–∞
                '200': { icon: 'fas fa-bolt', text: '–ì—Ä–æ–∑–∞ —Å –Ω–µ–±–æ–ª—å—à–∏–º –¥–æ–∂–¥–µ–º', bg: 'stormy' },
                '201': { icon: 'fas fa-bolt', text: '–ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥–µ–º', bg: 'stormy' },
                '202': { icon: 'fas fa-bolt', text: '–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞', bg: 'stormy' },
                '210': { icon: 'fas fa-bolt', text: '–ù–µ–±–æ–ª—å—à–∞—è –≥—Ä–æ–∑–∞', bg: 'stormy' },
                '211': { icon: 'fas fa-bolt', text: '–ì—Ä–æ–∑–∞', bg: 'stormy' },
                '212': { icon: 'fas fa-bolt', text: '–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞', bg: 'stormy' },
                '221': { icon: 'fas fa-bolt', text: '–ì—Ä–æ–∑–∞ —Å –ª–∏–≤–Ω–µ–º', bg: 'stormy' },
                '230': { icon: 'fas fa-bolt', text: '–ì—Ä–æ–∑–∞ —Å –º–æ—Ä–æ—Å—è—â–∏–º –¥–æ–∂–¥–µ–º', bg: 'stormy' },
                '231': { icon: 'fas fa-bolt', text: '–ì—Ä–æ–∑–∞ —Å –º–æ—Ä–æ—Å—è—â–∏–º –¥–æ–∂–¥–µ–º', bg: 'stormy' },
                '232': { icon: 'fas fa-bolt', text: '–ì—Ä–æ–∑–∞ —Å —Å–∏–ª—å–Ω—ã–º –¥–æ–∂–¥–µ–º', bg: 'stormy' },
                
                // –ì—Ä—É–ø–ø–∞ 3xx: –ú–æ—Ä–æ—Å—å
                '300': { icon: 'fas fa-cloud-rain', text: '–°–ª–∞–±–∞—è –º–æ—Ä–æ—Å—å', bg: 'rainy' },
                '301': { icon: 'fas fa-cloud-rain', text: '–ú–æ—Ä–æ—Å—å', bg: 'rainy' },
                '302': { icon: 'fas fa-cloud-rain', text: '–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å', bg: 'rainy' },
                '310': { icon: 'fas fa-cloud-rain', text: '–ú–æ—Ä–æ—Å—è—â–∏–π –¥–æ–∂–¥—å', bg: 'rainy' },
                '311': { icon: 'fas fa-cloud-rain', text: '–ú–æ—Ä–æ—Å—è—â–∏–π –¥–æ–∂–¥—å', bg: 'rainy' },
                '312': { icon: 'fas fa-cloud-rain', text: '–°–∏–ª—å–Ω—ã–π –º–æ—Ä–æ—Å—è—â–∏–π –¥–æ–∂–¥—å', bg: 'rainy' },
                '313': { icon: 'fas fa-cloud-rain', text: '–õ–∏–≤–µ–Ω—å —Å –º–æ—Ä–æ—Å—å—é', bg: 'rainy' },
                '314': { icon: 'fas fa-cloud-rain', text: '–°–∏–ª—å–Ω—ã–π –ª–∏–≤–µ–Ω—å —Å –º–æ—Ä–æ—Å—å—é', bg: 'rainy' },
                '321': { icon: 'fas fa-cloud-rain', text: '–ú–æ—Ä–æ—Å—è—â–∏–π –ª–∏–≤–µ–Ω—å', bg: 'rainy' },
                
                // –ì—Ä—É–ø–ø–∞ 5xx: –î–æ–∂–¥—å
                '500': { icon: 'fas fa-cloud-rain', text: '–ù–µ–±–æ–ª—å—à–æ–π –¥–æ–∂–¥—å', bg: 'rainy' },
                '501': { icon: 'fas fa-cloud-rain', text: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å', bg: 'rainy' },
                '502': { icon: 'fas fa-cloud-showers-heavy', text: '–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å', bg: 'rainy' },
                '503': { icon: 'fas fa-cloud-showers-heavy', text: '–û—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å', bg: 'rainy' },
                '504': { icon: 'fas fa-cloud-showers-heavy', text: '–õ–∏–≤–µ–Ω—å', bg: 'rainy' },
                '511': { icon: 'fas fa-cloud-meatball', text: '–õ–µ–¥—è–Ω–æ–π –¥–æ–∂–¥—å', bg: 'rainy' },
                '520': { icon: 'fas fa-cloud-showers-heavy', text: '–ù–µ–±–æ–ª—å—à–æ–π –ª–∏–≤–µ–Ω—å', bg: 'rainy' },
                '521': { icon: 'fas fa-cloud-showers-heavy', text: '–õ–∏–≤–µ–Ω—å', bg: 'rainy' },
                '522': { icon: 'fas fa-cloud-showers-water', text: '–°–∏–ª—å–Ω—ã–π –ª–∏–≤–µ–Ω—å', bg: 'rainy' },
                '531': { icon: 'fas fa-cloud-showers-heavy', text: '–†–≤–∞–Ω—ã–π –ª–∏–≤–µ–Ω—å', bg: 'rainy' },
                
                // –ì—Ä—É–ø–ø–∞ 6xx: –°–Ω–µ–≥
                '600': { icon: 'fas fa-snowflake', text: '–ù–µ–±–æ–ª—å—à–æ–π —Å–Ω–µ–≥', bg: 'snowy' },
                '601': { icon: 'fas fa-snowflake', text: '–°–Ω–µ–≥', bg: 'snowy' },
                '602': { icon: 'fas fa-snowflake', text: '–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥', bg: 'snowy' },
                '611': { icon: 'fas fa-snowflake', text: '–ú–æ–∫—Ä—ã–π —Å–Ω–µ–≥', bg: 'snowy' },
                '612': { icon: 'fas fa-snowflake', text: '–ù–µ–±–æ–ª—å—à–æ–π –º–æ–∫—Ä—ã–π —Å–Ω–µ–≥', bg: 'snowy' },
                '613': { icon: 'fas fa-snowflake', text: '–ú–æ–∫—Ä—ã–π —Å–Ω–µ–≥', bg: 'snowy' },
                '615': { icon: 'fas fa-snowflake', text: '–ù–µ–±–æ–ª—å—à–æ–π –¥–æ–∂–¥—å —Å–æ —Å–Ω–µ–≥–æ–º', bg: 'snowy' },
                '616': { icon: 'fas fa-snowflake', text: '–î–æ–∂–¥—å —Å–æ —Å–Ω–µ–≥–æ–º', bg: 'snowy' },
                '620': { icon: 'fas fa-snowflake', text: '–ù–µ–±–æ–ª—å—à–æ–π —Å–Ω–µ–≥–æ–ø–∞–¥', bg: 'snowy' },
                '621': { icon: 'fas fa-snowflake', text: '–°–Ω–µ–≥–æ–ø–∞–¥', bg: 'snowy' },
                '622': { icon: 'fas fa-snowflake', text: '–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥', bg: 'snowy' },
                
                // –ì—Ä—É–ø–ø–∞ 7xx: –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ —è–≤–ª–µ–Ω–∏—è
                '701': { icon: 'fas fa-smog', text: '–¢—É–º–∞–Ω', bg: 'cloudy' },
                '711': { icon: 'fas fa-smog', text: '–î—ã–º–∫–∞', bg: 'cloudy' },
                '721': { icon: 'fas fa-smog', text: '–î—ã–º–∫–∞', bg: 'cloudy' },
                '731': { icon: 'fas fa-wind', text: '–ü—ã–ª—å–Ω—ã–µ –≤–∏—Ö—Ä–∏', bg: 'cloudy' },
                '741': { icon: 'fas fa-smog', text: '–¢—É–º–∞–Ω', bg: 'cloudy' },
                '751': { icon: 'fas fa-wind', text: '–ü–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è', bg: 'cloudy' },
                '761': { icon: 'fas fa-wind', text: '–ü—ã–ª—å', bg: 'cloudy' },
                '762': { icon: 'fas fa-volcano', text: '–í—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–∏–π –ø–µ–ø–µ–ª', bg: 'cloudy' },
                '771': { icon: 'fas fa-wind', text: '–®–∫–≤–∞–ª', bg: 'stormy' },
                '781': { icon: 'fas fa-tornado', text: '–¢–æ—Ä–Ω–∞–¥–æ', bg: 'stormy' },
                
                // –ì—Ä—É–ø–ø–∞ 800: –Ø—Å–Ω–æ
                '800': { icon: 'fas fa-sun', text: '–Ø—Å–Ω–æ', bg: 'sunny' },
                
                // –ì—Ä—É–ø–ø–∞ 80x: –û–±–ª–∞—á–Ω–æ
                '801': { icon: 'fas fa-cloud-sun', text: '–ù–µ–±–æ–ª—å—à–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å', bg: 'sunny' },
                '802': { icon: 'fas fa-cloud', text: '–†–∞—Å—Å–µ—è–Ω–Ω—ã–µ –æ–±–ª–∞–∫–∞', bg: 'cloudy' },
                '803': { icon: 'fas fa-cloud', text: '–û–±–ª–∞—á–Ω–æ —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏', bg: 'cloudy' },
                '804': { icon: 'fas fa-cloud', text: '–ü–∞—Å–º—É—Ä–Ω–æ', bg: 'cloudy' }
            };

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            let currentUnit = 'celsius';
            let currentWeatherData = null;
            let currentLocation = { lat: 55.7558, lon: 37.6173, city: '–ú–æ—Å–∫–≤–∞' };
            let refreshInterval = null;
            let lastUpdate = null;

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            async function init() {
                loadCookies();
                setupEventListeners();
                updateDateTime();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
                const savedCity = getCookie('lastCity');
                if (savedCity) {
                    await getWeatherByCity(savedCity);
                } else {
                    getWeatherByLocation();
                }
                
                // –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                startAutoRefresh();
                setInterval(updateDateTime, 60000);
            }

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            function setupEventListeners() {
                searchBtn.addEventListener('click', async () => {
                    const city = citySearch.value.trim();
                    if (city) {
                        await getWeatherByCity(city);
                    }
                });

                citySearch.addEventListener('keypress', async (e) => {
                    if (e.key === 'Enter') {
                        const city = citySearch.value.trim();
                        if (city) {
                            await getWeatherByCity(city);
                        }
                    }
                });

                locationBtn.addEventListener('click', () => {
                    getWeatherByLocation();
                });

                unitBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const unit = btn.dataset.unit;
                        setTemperatureUnit(unit);
                    });
                });

                acceptCookiesBtn.addEventListener('click', acceptCookies);
                cookiePolicyLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    cookieModal.style.display = 'flex';
                });

                closeModalBtn.addEventListener('click', () => {
                    cookieModal.style.display = 'none';
                });

                window.addEventListener('click', (e) => {
                    if (e.target === cookieModal) {
                        cookieModal.style.display = 'none';
                    }
                });

                // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–≤–æ–¥–∞
                citySearch.addEventListener('input', () => {
                    if (citySearch.value.length > 2) {
                        debouncedSearch(citySearch.value);
                    }
                });
            }

            // Debounce –¥–ª—è –ø–æ–∏—Å–∫–∞
            let searchTimeout;
            function debouncedSearch(query) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(async () => {
                    await searchCities(query);
                }, 500);
            }

            // –†–∞–±–æ—Ç–∞ —Å cookies
            function loadCookies() {
                const unit = getCookie('unit');
                if (unit) {
                    setTemperatureUnit(unit);
                }

                if (!getCookie('cookiesAccepted')) {
                    cookieNotice.style.display = 'block';
                }
            }

            function setCookie(name, value, days = 365) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                const expires = "expires=" + date.toUTCString();
                document.cookie = `${name}=${value};${expires};path=/;SameSite=Lax`;
            }

            function getCookie(name) {
                const cookies = document.cookie.split(';').reduce((acc, cookie) => {
                    const [key, value] = cookie.trim().split('=');
                    acc[key] = value;
                    return acc;
                }, {});
                return cookies[name];
            }

            function acceptCookies() {
                setCookie('cookiesAccepted', 'true', 365);
                cookieNotice.style.display = 'none';
            }

            function setTemperatureUnit(unit) {
                currentUnit = unit;
                setCookie('unit', unit, 365);
                
                unitBtns.forEach(btn => {
                    if (btn.dataset.unit === unit) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });

                if (currentWeatherData) {
                    updateWeatherDisplay(currentWeatherData);
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
            function updateDateTime() {
                const now = new Date();
                const options = {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                currentDate.textContent = now.toLocaleDateString('ru-RU', options);
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–Ω—è
                updateDayProgress(now);
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–Ω—è
            function updateDayProgress(now) {
                const sunriseTime = sunrise.textContent;
                const sunsetTime = sunset.textContent;
                
                if (sunriseTime !== '--:--' && sunsetTime !== '--:--') {
                    const [sunriseHour, sunriseMin] = sunriseTime.split(':').map(Number);
                    const [sunsetHour, sunsetMin] = sunsetTime.split(':').map(Number);
                    
                    const sunriseDate = new Date(now);
                    sunriseDate.setHours(sunriseHour, sunriseMin, 0, 0);
                    
                    const sunsetDate = new Date(now);
                    sunsetDate.setHours(sunsetHour, sunsetMin, 0, 0);
                    
                    const totalDayDuration = sunsetDate - sunriseDate;
                    const currentProgress = now - sunriseDate;
                    
                    let progressPercent = (currentProgress / totalDayDuration) * 100;
                    progressPercent = Math.max(0, Math.min(100, progressPercent));
                    
                    dayProgress.style.width = `${progressPercent}%`;
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
                    if (now < sunriseDate || now > sunsetDate) {
                        dayProgress.style.background = 'linear-gradient(90deg, #2c3e50, #34495e)';
                    } else if (progressPercent < 30) {
                        dayProgress.style.background = 'linear-gradient(90deg, #ff8a00, #ffcc00)';
                    } else if (progressPercent < 70) {
                        dayProgress.style.background = 'linear-gradient(90deg, #4ecdc4, #44a08d)';
                    } else {
                        dayProgress.style.background = 'linear-gradient(90deg, #ff6b6b, #ee5a24)';
                    }
                }
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã –ø–æ –≥–æ—Ä–æ–¥—É
            async function getWeatherByCity(city) {
                showLoader();
                hideError();
                
                try {
                    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥–æ—Ä–æ–¥–∞
                    const geocodeUrl = `${WEATHER_SERVICES.GEOCODING}?q=${encodeURIComponent(city)}&limit=1&appid=${API_KEYS.openweather}`;
                    const geocodeResponse = await fetch(geocodeUrl);
                    
                    if (!geocodeResponse.ok) {
                        throw new Error('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }
                    
                    const geocodeData = await geocodeResponse.json();
                    
                    if (!geocodeData || geocodeData.length === 0) {
                        throw new Error('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }
                    
                    const { lat, lon, name, country } = geocodeData[0];
                    currentLocation = { lat, lon, city: name };
                    
                    // –ü–æ–ª—É—á–∞–µ–º –ø–æ–≥–æ–¥—É
                    await getWeatherByCoords(lat, lon, name);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ cookies
                    setCookie('lastCity', name, 7);
                    setCookie('lastLat', lat, 7);
                    setCookie('lastLon', lon, 7);
                    
                    // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
                    citySearch.value = '';
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã:', error);
                    showError(error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ');
                } finally {
                    hideLoader();
                }
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
            async function getWeatherByCoords(lat, lon, cityName = null) {
                showLoader();
                
                try {
                    // –¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞
                    const currentUrl = `${WEATHER_SERVICES.CURRENT}?lat=${lat}&lon=${lon}&appid=${API_KEYS.openweather}&units=metric&lang=ru`;
                    const currentResponse = await fetch(currentUrl);
                    
                    if (!currentResponse.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥—ã');
                    }
                    
                    const currentData = await currentResponse.json();
                    
                    // –ü—Ä–æ–≥–Ω–æ–∑
                    const forecastUrl = `${WEATHER_SERVICES.FORECAST}?lat=${lat}&lon=${lon}&appid=${API_KEYS.openweather}&units=metric&lang=ru&cnt=40`;
                    const forecastResponse = await fetch(forecastUrl);
                    
                    if (!forecastResponse.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞');
                    }
                    
                    const forecastData = await forecastResponse.json();
                    
                    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    currentWeatherData = {
                        city: cityName || currentData.name,
                        current: {
                            temp: currentData.main.temp,
                            feels_like: currentData.main.feels_like,
                            condition: currentData.weather[0].id.toString(),
                            condition_text: currentData.weather[0].description,
                            icon: currentData.weather[0].icon,
                            wind_speed: currentData.wind.speed,
                            humidity: currentData.main.humidity,
                            pressure: currentData.main.pressure,
                            visibility: currentData.visibility / 1000,
                            sunrise: new Date(currentData.sys.sunrise * 1000),
                            sunset: new Date(currentData.sys.sunset * 1000)
                        },
                        forecast: forecastData.list,
                        daily: groupForecastByDay(forecastData.list)
                    };
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    updateWeatherDisplay(currentWeatherData);
                    updateWeatherBackground(currentWeatherData.current.condition);
                    createWeatherAnimation(currentWeatherData.current.condition);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    lastUpdate = new Date();
                    updateLiveBadge();
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã:', error);
                    
                    // –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π API
                    await tryAlternativeWeatherAPI(lat, lon, cityName);
                } finally {
                    hideLoader();
                }
            }

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ –¥–Ω—è–º
            function groupForecastByDay(forecastList) {
                const daily = {};
                
                forecastList.forEach(item => {
                    const date = new Date(item.dt * 1000);
                    const dayKey = date.toDateString();
                    
                    if (!daily[dayKey]) {
                        daily[dayKey] = {
                            date: date,
                            temps: [],
                            conditions: [],
                            icons: [],
                            descriptions: []
                        };
                    }
                    
                    daily[dayKey].temps.push(item.main.temp);
                    daily[dayKey].conditions.push(item.weather[0].id);
                    daily[dayKey].icons.push(item.weather[0].icon);
                    daily[dayKey].descriptions.push(item.weather[0].description);
                });
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
                return Object.values(daily).map(day => {
                    const avgTemp = day.temps.reduce((a, b) => a + b) / day.temps.length;
                    const maxTemp = Math.max(...day.temps);
                    const minTemp = Math.min(...day.temps);
                    
                    // –ù–∞—Ö–æ–¥–∏–º –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—É—é –ø–æ–≥–æ–¥—É
                    const conditionCounts = {};
                    day.conditions.forEach(cond => {
                        conditionCounts[cond] = (conditionCounts[cond] || 0) + 1;
                    });
                    
                    const mostCommonCondition = Object.keys(conditionCounts).reduce((a, b) => 
                        conditionCounts[a] > conditionCounts[b] ? a : b
                    );
                    
                    return {
                        date: day.date,
                        temp_day: maxTemp,
                        temp_night: minTemp,
                        temp_avg: avgTemp,
                        condition: mostCommonCondition.toString(),
                        condition_text: day.descriptions[0]
                    };
                }).slice(0, 7); // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ 7 –¥–Ω–µ–π
            }

            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π API
            async function tryAlternativeWeatherAPI(lat, lon, cityName) {
                try {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Open-Meteo (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∫–ª—é—á–∞)
                    const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,relativehumidity_2m,windspeed_10m,weathercode&daily=sunrise,sunset&timezone=auto`);
                    
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ API');
                    }
                    
                    const data = await response.json();
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ Open-Meteo –≤ –Ω–∞—à —Ñ–æ—Ä–º–∞—Ç
                    const weatherCode = data.current_weather.weathercode;
                    const weatherInfo = getWeatherInfoByCode(weatherCode);
                    
                    currentWeatherData = {
                        city: cityName || '–¢–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ',
                        current: {
                            temp: data.current_weather.temperature,
                            feels_like: data.current_weather.temperature,
                            condition: weatherCode.toString(),
                            condition_text: weatherInfo.text,
                            icon: weatherInfo.icon,
                            wind_speed: data.current_weather.windspeed,
                            humidity: data.hourly.relativehumidity_2m[0],
                            pressure: 1013, // –°—Ä–µ–¥–Ω–µ–µ –¥–∞–≤–ª–µ–Ω–∏–µ
                            visibility: 10,
                            sunrise: new Date(data.daily.sunrise[0]),
                            sunset: new Date(data.daily.sunset[0])
                        },
                        forecast: [],
                        daily: []
                    };
                    
                    // –°–æ–∑–¥–∞–µ–º –ø–æ—á–∞—Å–æ–≤–æ–π –ø—Ä–æ–≥–Ω–æ–∑
                    for (let i = 0; i < 24; i++) {
                        const hourCode = data.hourly.weathercode[i];
                        const hourInfo = getWeatherInfoByCode(hourCode);
                        
                        currentWeatherData.forecast.push({
                            dt: Date.now() / 1000 + i * 3600,
                            main: { temp: data.hourly.temperature_2m[i] },
                            weather: [{
                                id: hourCode,
                                description: hourInfo.text,
                                icon: hourInfo.icon
                            }]
                        });
                    }
                    
                    // –°–æ–∑–¥–∞–µ–º –¥–Ω–µ–≤–Ω–æ–π –ø—Ä–æ–≥–Ω–æ–∑
                    for (let i = 0; i < 7; i++) {
                        const dayTemp = data.hourly.temperature_2m[i * 24];
                        const dayCode = data.hourly.weathercode[i * 24];
                        const dayInfo = getWeatherInfoByCode(dayCode);
                        
                        currentWeatherData.daily.push({
                            date: new Date(Date.now() + i * 24 * 3600 * 1000),
                            temp_day: dayTemp + 5,
                            temp_night: dayTemp - 5,
                            temp_avg: dayTemp,
                            condition: dayCode.toString(),
                            condition_text: dayInfo.text
                        });
                    }
                    
                    updateWeatherDisplay(currentWeatherData);
                    updateWeatherBackground(currentWeatherData.current.condition);
                    createWeatherAnimation(currentWeatherData.current.condition);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ API:', error);
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
                }
            }

            // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø–æ–≥–æ–¥—ã Open-Meteo
            function getWeatherInfoByCode(code) {
                const codes = {
                    0: { icon: 'fas fa-sun', text: '–Ø—Å–Ω–æ', bg: 'sunny' },
                    1: { icon: 'fas fa-cloud-sun', text: '–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —è—Å–Ω–æ', bg: 'sunny' },
                    2: { icon: 'fas fa-cloud', text: '–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å', bg: 'cloudy' },
                    3: { icon: 'fas fa-cloud', text: '–û–±–ª–∞—á–Ω–æ', bg: 'cloudy' },
                    45: { icon: 'fas fa-smog', text: '–¢—É–º–∞–Ω', bg: 'cloudy' },
                    48: { icon: 'fas fa-smog', text: '–ò–∑–º–æ—Ä–æ–∑—å', bg: 'cloudy' },
                    51: { icon: 'fas fa-cloud-rain', text: '–õ–µ–≥–∫–∞—è –º–æ—Ä–æ—Å—å', bg: 'rainy' },
                    53: { icon: 'fas fa-cloud-rain', text: '–£–º–µ—Ä–µ–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å', bg: 'rainy' },
                    55: { icon: 'fas fa-cloud-rain', text: '–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å', bg: 'rainy' },
                    56: { icon: 'fas fa-snowflake', text: '–õ–µ–¥—è–Ω–∞—è –º–æ—Ä–æ—Å—å', bg: 'snowy' },
                    57: { icon: 'fas fa-snowflake', text: '–°–∏–ª—å–Ω–∞—è –ª–µ–¥—è–Ω–∞—è –º–æ—Ä–æ—Å—å', bg: 'snowy' },
                    61: { icon: 'fas fa-cloud-rain', text: '–ù–µ–±–æ–ª—å—à–æ–π –¥–æ–∂–¥—å', bg: 'rainy' },
                    63: { icon: 'fas fa-cloud-rain', text: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å', bg: 'rainy' },
                    65: { icon: 'fas fa-cloud-showers-heavy', text: '–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å', bg: 'rainy' },
                    66: { icon: 'fas fa-snowflake', text: '–õ–µ–¥—è–Ω–æ–π –¥–æ–∂–¥—å', bg: 'snowy' },
                    67: { icon: 'fas fa-snowflake', text: '–°–∏–ª—å–Ω—ã–π –ª–µ–¥—è–Ω–æ–π –¥–æ–∂–¥—å', bg: 'snowy' },
                    71: { icon: 'fas fa-snowflake', text: '–ù–µ–±–æ–ª—å—à–æ–π —Å–Ω–µ–≥', bg: 'snowy' },
                    73: { icon: 'fas fa-snowflake', text: '–£–º–µ—Ä–µ–Ω–Ω—ã–π —Å–Ω–µ–≥', bg: 'snowy' },
                    75: { icon: 'fas fa-snowflake', text: '–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥', bg: 'snowy' },
                    77: { icon: 'fas fa-snowflake', text: '–°–Ω–µ–∂–Ω—ã–µ –∑–µ—Ä–Ω–∞', bg: 'snowy' },
                    80: { icon: 'fas fa-cloud-showers-heavy', text: '–ù–µ–±–æ–ª—å—à–æ–π –ª–∏–≤–µ–Ω—å', bg: 'rainy' },
                    81: { icon: 'fas fa-cloud-showers-heavy', text: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –ª–∏–≤–µ–Ω—å', bg: 'rainy' },
                    82: { icon: 'fas fa-cloud-showers-water', text: '–°–∏–ª—å–Ω—ã–π –ª–∏–≤–µ–Ω—å', bg: 'rainy' },
                    85: { icon: 'fas fa-snowflake', text: '–ù–µ–±–æ–ª—å—à–æ–π —Å–Ω–µ–≥–æ–ø–∞–¥', bg: 'snowy' },
                    86: { icon: 'fas fa-snowflake', text: '–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥–æ–ø–∞–¥', bg: 'snowy' },
                    95: { icon: 'fas fa-bolt', text: '–ì—Ä–æ–∑–∞', bg: 'stormy' },
                    96: { icon: 'fas fa-bolt', text: '–ì—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º', bg: 'stormy' },
                    99: { icon: 'fas fa-bolt', text: '–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º', bg: 'stormy' }
                };
                
                return codes[code] || { icon: 'fas fa-question', text: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ', bg: 'cloudy' };
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã –ø–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é
            function getWeatherByLocation() {
                if (!navigator.geolocation) {
                    showError('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º');
                    return;
                }

                showLoader();
                
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const { latitude, longitude } = position.coords;
                        
                        try {
                            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
                            const reverseGeoUrl = `${WEATHER_SERVICES.REVERSE_GEO}?lat=${latitude}&lon=${longitude}&limit=1&appid=${API_KEYS.openweather}`;
                            const response = await fetch(reverseGeoUrl);
                            
                            let cityName = '–¢–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
                            if (response.ok) {
                                const data = await response.json();
                                if (data && data.length > 0) {
                                    cityName = data[0].name;
                                }
                            }
                            
                            await getWeatherByCoords(latitude, longitude, cityName);
                            
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è:', error);
                            showError('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à –≥–æ—Ä–æ–¥');
                        } finally {
                            hideLoader();
                        }
                    },
                    (error) => {
                        console.error('–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', error);
                        hideLoader();
                        showError('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏.');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã
            function updateWeatherDisplay(data) {
                // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                currentCity.textContent = data.city;
                currentTemp.textContent = formatTemperature(data.current.temp);
                feelsLike.textContent = formatTemperature(data.current.feels_like);
                
                // –ò–∫–æ–Ω–∫–∞ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≥–æ–¥—ã
                const condition = data.current.condition;
                const weatherInfo = weatherIcons[condition] || { icon: 'fas fa-question', text: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ', bg: 'cloudy' };
                
                conditionIcon.innerHTML = `<i class="${weatherInfo.icon}"></i>`;
                conditionText.textContent = capitalizeFirstLetter(data.current.condition_text);
                
                // –î–µ—Ç–∞–ª–∏
                windSpeed.textContent = `${data.current.wind_speed.toFixed(1)} –º/—Å`;
                humidity.textContent = `${Math.round(data.current.humidity)}%`;
                pressure.textContent = `${Math.round(data.current.pressure)} –≥–ü–∞`;
                uvIndex.textContent = calculateUVIndex(data.current.temp, data.current.clouds);
                
                // –í–æ—Å—Ö–æ–¥ –∏ –∑–∞–∫–∞—Ç
                if (data.current.sunrise) {
                    const sunriseTime = formatTime(data.current.sunrise);
                    const sunsetTime = formatTime(data.current.sunset);
                    sunrise.textContent = sunriseTime;
                    sunset.textContent = sunsetTime;
                }
                
                // –í–∏–¥–∏–º–æ—Å—Ç—å
                const visibilityKm = data.current.visibility || 10;
                visibility.textContent = `${visibilityKm.toFixed(1)} –∫–º`;
                visibilityDesc.textContent = getVisibilityDescription(visibilityKm);
                
                // –û—Å–∞–¥–∫–∏ (—Ä–∞—Å—á–µ—Ç–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)
                const precipChance = calculatePrecipitationChance(data.current.humidity, data.current.condition);
                precipitation.textContent = `${(precipChance / 10).toFixed(1)} –º–º`;
                precipitationChance.textContent = `${precipChance}%`;
                
                // –ü–æ—á–∞—Å–æ–≤–æ–π –ø—Ä–æ–≥–Ω–æ–∑
                updateHourlyForecast(data.forecast);
                
                // –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–µ–¥–µ–ª—é
                updateDailyForecast(data.daily);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–Ω—è
                updateDayProgress(new Date());
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
            function formatTemperature(temp) {
                if (currentUnit === 'fahrenheit') {
                    return Math.round((temp * 9/5) + 32) + '¬∞F';
                }
                return Math.round(temp) + '¬∞C';
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
            function formatTime(date) {
                if (!(date instanceof Date)) {
                    date = new Date(date);
                }
                return date.toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: false 
                });
            }

            // –†–∞—Å—á–µ—Ç –£–§ –∏–Ω–¥–µ–∫—Å–∞
            function calculateUVIndex(temp, clouds) {
                const baseUV = Math.min(11, Math.floor(temp / 3));
                const cloudFactor = clouds ? (100 - clouds) / 100 : 0.7;
                return Math.max(1, Math.round(baseUV * cloudFactor));
            }

            // –†–∞—Å—á–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –æ—Å–∞–¥–∫–æ–≤
            function calculatePrecipitationChance(humidity, condition) {
                let baseChance = humidity > 80 ? 70 : humidity > 60 ? 40 : 20;
                
                // –£—á–∏—Ç—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É
                if (condition >= 200 && condition < 300) baseChance = 90; // –ì—Ä–æ–∑–∞
                if (condition >= 300 && condition < 400) baseChance = 60; // –ú–æ—Ä–æ—Å—å
                if (condition >= 500 && condition < 600) baseChance = 80; // –î–æ–∂–¥—å
                if (condition >= 600 && condition < 700) baseChance = 70; // –°–Ω–µ–≥
                
                return Math.min(99, baseChance);
            }

            // –û–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏
            function getVisibilityDescription(km) {
                if (km >= 20) return '–û—Ç–ª–∏—á–Ω–∞—è';
                if (km >= 10) return '–•–æ—Ä–æ—à–∞—è';
                if (km >= 5) return '–£–º–µ—Ä–µ–Ω–Ω–∞—è';
                if (km >= 2) return '–ü–ª–æ—Ö–∞—è';
                return '–û—á–µ–Ω—å –ø–ª–æ—Ö–∞—è';
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—á–∞—Å–æ–≤–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞
            function updateHourlyForecast(forecastData) {
                hourlyContainer.innerHTML = '';
                
                // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞ –∏–ª–∏ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ
                const hours = forecastData.slice(0, 24);
                
                hours.forEach((hour, index) => {
                    const time = new Date(hour.dt * 1000);
                    const hourStr = time.getHours().toString().padStart(2, '0') + ':00';
                    
                    const weatherInfo = weatherIcons[hour.weather[0].id.toString()] || 
                                      { icon: 'fas fa-question', text: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' };
                    
                    const hourCard = document.createElement('div');
                    hourCard.className = 'hour-card';
                    
                    // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —á–∞—Å
                    const now = new Date();
                    if (time.getHours() === now.getHours()) {
                        hourCard.classList.add('active');
                    }
                    
                    hourCard.innerHTML = `
                        <div class="hour-time">${index === 0 ? '–°–µ–π—á–∞—Å' : hourStr}</div>
                        <div class="hour-icon"><i class="${weatherInfo.icon}"></i></div>
                        <div class="hour-temp">${formatTemperature(hour.main.temp)}</div>
                        <div class="hour-condition">${capitalizeFirstLetter(hour.weather[0].description)}</div>
                    `;
                    
                    hourlyContainer.appendChild(hourCard);
                });
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞
            function updateDailyForecast(dailyData) {
                dailyContainer.innerHTML = '';
                
                const daysOfWeek = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
                
                dailyData.forEach((day, index) => {
                    const date = day.date instanceof Date ? day.date : new Date(day.date);
                    const dayName = index === 0 ? '–°–µ–≥–æ–¥–Ω—è' : index === 1 ? '–ó–∞–≤—Ç—Ä–∞' : daysOfWeek[date.getDay()];
                    const dayDate = date.getDate().toString().padStart(2, '0') + '.' + (date.getMonth() + 1).toString().padStart(2, '0');
                    
                    const weatherInfo = weatherIcons[day.condition] || 
                                      { icon: 'fas fa-question', text: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' };
                    
                    const dayCard = document.createElement('div');
                    dayCard.className = 'day-card';
                    
                    // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å
                    const today = new Date();
                    if (date.getDate() === today.getDate() && date.getMonth() === today.getMonth()) {
                        dayCard.classList.add('active');
                    }
                    
                    dayCard.innerHTML = `
                        <div class="day-name">${dayName}</div>
                        <div class="day-date">${dayDate}</div>
                        <div class="day-icon"><i class="${weatherInfo.icon}"></i></div>
                        <div class="day-condition">${capitalizeFirstLetter(day.condition_text)}</div>
                        <div class="day-temp">
                            <span class="temp-day">${formatTemperature(day.temp_day)}</span>
                            <span class="temp-night">${formatTemperature(day.temp_night)}</span>
                        </div>
                    `;
                    
                    dailyContainer.appendChild(dayCard);
                });
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–≥–æ–¥—ã
            function updateWeatherBackground(conditionCode) {
                const weatherInfo = weatherIcons[conditionCode] || { bg: 'cloudy' };
                weatherBg.style.background = `var(--${weatherInfo.bg})`;
            }

            // –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–≥–æ–¥—ã
            function createWeatherAnimation(conditionCode) {
                weatherAnimation.innerHTML = '';
                
                const weatherInfo = weatherIcons[conditionCode] || { bg: 'cloudy' };
                
                // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –ø–æ–≥–æ–¥—ã
                if (weatherInfo.bg === 'sunny') {
                    createSunAnimation();
                } else if (weatherInfo.bg === 'cloudy') {
                    createCloudAnimation();
                } else if (weatherInfo.bg === 'rainy') {
                    createRainAnimation();
                } else if (weatherInfo.bg === 'snowy') {
                    createSnowAnimation();
                } else if (weatherInfo.bg === 'stormy') {
                    createStormAnimation();
                }
            }

            function createSunAnimation() {
                for (let i = 0; i < 20; i++) {
                    const ray = document.createElement('div');
                    ray.style.position = 'absolute';
                    ray.style.width = '2px';
                    ray.style.height = '100px';
                    ray.style.background = 'linear-gradient(to bottom, transparent, #ffd700, transparent)';
                    ray.style.left = `${Math.random() * 100}%`;
                    ray.style.top = `${Math.random() * 100}%`;
                    ray.style.opacity = '0.3';
                    ray.style.transform = `rotate(${Math.random() * 360}deg)`;
                    ray.style.animation = `float ${3 + Math.random() * 7}s infinite ease-in-out`;
                    weatherAnimation.appendChild(ray);
                }
            }

            function createCloudAnimation() {
                for (let i = 0; i < 10; i++) {
                    const cloud = document.createElement('div');
                    cloud.style.position = 'absolute';
                    cloud.style.width = `${100 + Math.random() * 200}px`;
                    cloud.style.height = '60px';
                    cloud.style.background = 'rgba(255, 255, 255, 0.1)';
                    cloud.style.borderRadius = '50px';
                    cloud.style.left = `${Math.random() * 100}%`;
                    cloud.style.top = `${Math.random() * 100}%`;
                    cloud.style.opacity = '0.5';
                    cloud.style.filter = 'blur(20px)';
                    cloud.style.animation = `float ${20 + Math.random() * 40}s infinite linear`;
                    weatherAnimation.appendChild(cloud);
                }
            }

            function createRainAnimation() {
                for (let i = 0; i < 50; i++) {
                    const drop = document.createElement('div');
                    drop.style.position = 'absolute';
                    drop.style.width = '1px';
                    drop.style.height = '20px';
                    drop.style.background = 'linear-gradient(to bottom, transparent, #87CEEB, transparent)';
                    drop.style.left = `${Math.random() * 100}%`;
                    drop.style.top = '-20px';
                    drop.style.opacity = '0.6';
                    drop.style.animation = `rain ${1 + Math.random() * 2}s infinite linear`;
                    drop.style.animationDelay = `${Math.random() * 2}s`;
                    weatherAnimation.appendChild(drop);
                }
            }

            function createSnowAnimation() {
                for (let i = 0; i < 30; i++) {
                    const flake = document.createElement('div');
                    flake.style.position = 'absolute';
                    flake.style.width = '10px';
                    flake.style.height = '10px';
                    flake.style.background = 'rgba(255, 255, 255, 0.8)';
                    flake.style.borderRadius = '50%';
                    flake.style.left = `${Math.random() * 100}%`;
                    flake.style.top = '-10px';
                    flake.style.opacity = '0.8';
                    flake.style.filter = 'blur(1px)';
                    flake.style.animation = `snow ${5 + Math.random() * 10}s infinite linear`;
                    flake.style.animationDelay = `${Math.random() * 5}s`;
                    weatherAnimation.appendChild(flake);
                }
            }

            function createStormAnimation() {
                for (let i = 0; i < 5; i++) {
                    const lightning = document.createElement('div');
                    lightning.style.position = 'absolute';
                    lightning.style.width = '2px';
                    lightning.style.height = '100px';
                    lightning.style.background = 'linear-gradient(to bottom, transparent, #ffff00, transparent)';
                    lightning.style.left = `${Math.random() * 100}%`;
                    lightning.style.top = `${Math.random() * 100}%`;
                    lightning.style.opacity = '0';
                    lightning.style.animation = `lightning ${3 + Math.random() * 5}s infinite`;
                    weatherAnimation.appendChild(lightning);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á–µ–≤—ã–µ –∫–∞–¥—Ä—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –º–æ–ª–Ω–∏–∏
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes lightning {
                        0%, 90% { opacity: 0; }
                        91%, 92% { opacity: 0.8; }
                        93%, 94% { opacity: 0.2; }
                        95%, 96% { opacity: 1; }
                        97%, 100% { opacity: 0; }
                    }
                    @keyframes rain {
                        0% { transform: translateY(-20px); }
                        100% { transform: translateY(100vh); }
                    }
                    @keyframes snow {
                        0% { transform: translateY(-10px) translateX(0); }
                        100% { transform: translateY(100vh) translateX(${Math.random() * 100 - 50}px); }
                    }
                `;
                document.head.appendChild(style);
            }

            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            function capitalizeFirstLetter(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }

            // –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–æ–≤
            async function searchCities(query) {
                if (query.length < 2) return;
                
                try {
                    const response = await fetch(`${WEATHER_SERVICES.GEOCODING}?q=${encodeURIComponent(query)}&limit=5&appid=${API_KEYS.openweather}`);
                    if (response.ok) {
                        const cities = await response.json();
                        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–¥–µ—Å—å
                        console.log('–ù–∞–π–¥–µ–Ω—ã –≥–æ—Ä–æ–¥–∞:', cities);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–æ–≤:', error);
                }
            }

            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
            function startAutoRefresh() {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
                refreshInterval = setInterval(async () => {
                    if (currentLocation) {
                        await getWeatherByCoords(currentLocation.lat, currentLocation.lon, currentLocation.city);
                    }
                }, 5 * 60 * 1000); // 5 –º–∏–Ω—É—Ç
            }

            function updateLiveBadge() {
                if (lastUpdate) {
                    const now = new Date();
                    const diff = Math.floor((now - lastUpdate) / 1000);
                    
                    if (diff < 60) {
                        liveBadge.innerHTML = `<div class="live-dot"></div><span>LIVE (—Ç–æ–ª—å–∫–æ —á—Ç–æ)</span>`;
                    } else if (diff < 300) {
                        liveBadge.innerHTML = `<div class="live-dot"></div><span>LIVE (${Math.floor(diff / 60)} –º–∏–Ω –Ω–∞–∑–∞–¥)</span>`;
                    }
                    
                    // –ü—É–ª—å—Å–∞—Ü–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
                    liveBadge.style.animation = 'none';
                    setTimeout(() => {
                        liveBadge.style.animation = 'pulse 2s infinite';
                    }, 10);
                }
            }

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–∞–≥—Ä—É–∑–∫–∏
            function showLoader() {
                loader.style.display = 'block';
                document.querySelector('main').style.opacity = '0.5';
                document.querySelector('main').style.pointerEvents = 'none';
            }

            function hideLoader() {
                loader.style.display = 'none';
                document.querySelector('main').style.opacity = '1';
                document.querySelector('main').style.pointerEvents = 'auto';
            }

            function showError(message) {
                errorText.textContent = message;
                errorMessage.style.display = 'block';
            }

            function hideError() {
                errorMessage.style.display = 'none';
            }

            // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            init();
        });
    </script>
</body>
</html>